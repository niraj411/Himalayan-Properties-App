generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String
  phone         String?
  role          String    @default("TENANT") // ADMIN or TENANT
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  tenant        Tenant?
  reminders     Reminder[]
}

model Property {
  id          String   @id @default(cuid())
  name        String
  type        String   // RESIDENTIAL or COMMERCIAL
  address     String
  city        String
  state       String
  zip         String
  description String?
  imageUrl    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  units        Unit[]
  applications Application[]
}

model Unit {
  id         String   @id @default(cuid())
  propertyId String
  unitNumber String
  bedrooms   Int?
  bathrooms  Float?
  sqft       Int?
  rent       Float
  status     String   @default("VACANT") // VACANT, OCCUPIED, MAINTENANCE
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  property            Property             @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  tenant              Tenant?
  leases              Lease[]
  maintenanceRequests MaintenanceRequest[]

  @@unique([propertyId, unitNumber])
}

model Tenant {
  id               String    @id @default(cuid())
  userId           String    @unique
  unitId           String?   @unique
  moveInDate       DateTime?
  moveOutDate      DateTime?
  emergencyContact String?
  emergencyPhone   String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  user                User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  unit                Unit?                @relation(fields: [unitId], references: [id])
  leases              Lease[]
  maintenanceRequests MaintenanceRequest[]
}

model Lease {
  id          String   @id @default(cuid())
  tenantId    String
  unitId      String
  startDate   DateTime
  endDate     DateTime
  monthlyRent Float
  depositAmount Float?
  documentUrl String?
  status      String   @default("ACTIVE") // ACTIVE, EXPIRED, TERMINATED
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tenant   Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  unit     Unit      @relation(fields: [unitId], references: [id], onDelete: Cascade)
  payments Payment[]
}

model Application {
  id              String   @id @default(cuid())
  propertyId      String?
  firstName       String
  lastName        String
  email           String
  phone           String
  currentAddress  String?
  employerName    String?
  employerPhone   String?
  jobTitle        String?
  monthlyIncome   Float?
  moveInDate      DateTime?
  numberOfOccupants Int?
  pets            String?
  references      String?
  additionalNotes String?
  status          String   @default("PENDING") // PENDING, APPROVED, REJECTED
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  property Property? @relation(fields: [propertyId], references: [id])
}

model MaintenanceRequest {
  id          String   @id @default(cuid())
  tenantId    String
  unitId      String
  title       String
  description String
  category    String?  // PLUMBING, ELECTRICAL, HVAC, APPLIANCE, OTHER
  priority    String   @default("MEDIUM") // LOW, MEDIUM, HIGH, EMERGENCY
  status      String   @default("OPEN") // OPEN, IN_PROGRESS, COMPLETED, CANCELLED
  imageUrls   String?  // JSON array of image URLs
  notes       String?
  completedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  unit   Unit   @relation(fields: [unitId], references: [id], onDelete: Cascade)
}

model Payment {
  id        String   @id @default(cuid())
  leaseId   String
  amount    Float
  date      DateTime
  method    String?  // BANK_TRANSFER, CHECK, CASH, OTHER
  reference String?
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  lease Lease @relation(fields: [leaseId], references: [id], onDelete: Cascade)
}

model Reminder {
  id        String   @id @default(cuid())
  userId    String
  type      String   // LEASE_EXPIRY, RENT_DUE, MAINTENANCE, CUSTOM
  title     String
  message   String?
  dueDate   DateTime
  entityId  String?  // ID of related entity (lease, maintenance request, etc.)
  completed Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Settings {
  id             String  @id @default(cuid())
  companyName    String  @default("Himalayan Properties")
  companyEmail   String?
  companyPhone   String?
  companyAddress String?
  bankName       String?
  bankRoutingNumber String?
  bankAccountNumber String?
  checkMailingAddress String?
  paymentInstructions String?
}
